<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="manifest" href="./manifest.json" >
		<title>Yarn</title>
		<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="8gmp2fm55zkop6h"></script>
	</head>
	<body id="theme-dark" class="ms-Fabric">

		<!-- Fancy Background -->
		<div id="app-bg" class="grad">&nbsp;</div>

		<!-- Entry Point / Container -->
		<div id="app">

			<header>
				<img src="./public/images/yarn.png" />
				<div class="menu">
					<button id="file">File</button>
					<ul class="dropdown" id="menu-file">
						<li id="menu-open" data-bind="click: app.data.tryOpenFile">Open...</li>
						<li id="menu-append" data-bind="click: app.data.tryAppend">Append...</li>
						<hr/>
						<!-- ko if:data.editingPath() != null -->
							<li id="menu-save" data-bind="click: app.data.trySaveCurrent">Save</li>
						<!-- /ko -->
						<li id="menu-save-json" data-bind="click: function() { app.data.trySave('json');}">Save As JSON...</li>
						<li id="menu-save-yarn" data-bind="click: function() { app.data.trySave('yarn');}">Save As Yarn...</li>
						<li id="menu-save-twee" data-bind="click: function() { app.data.trySave('twee');}">Save As Twee...</li>
						<li id="menu-save-twee2" data-bind="click: function() { app.data.trySave('tw2');}">Save As Twee2...</li>
						<li id="menu-save-xml" data-bind="click: function() { app.data.trySave('xml');}">Save As XML...</li>
						<hr/>
						<li class="disabled" id="menu-load-dropbox" data-bind="click: function() { app.data.tryLoadDropbox();}">Load from Dropbox...</li>
						<li class="disabled" id="menu-save-dropbox" data-bind="click: function() { app.data.trySaveDropbox();}">Save to Dropbox...</li>
						<hr data-bind="visible:app.isElectron;" />
						<li id="menu-exit" data-bind="visible:app.isElectron; click:remote.app.quit();">Exit</li>
					</ul>
				</div>
				<div class="menu">
					<button id="nodes">Nodes</button>
					<ul class="dropdown" id="menu-nodes">
						<li data-bind="click:app.newNode" id="menu-nodes-horizontal">Add new node</li>
						<hr/>
						<li data-bind="click: app.arrangeX" id="menu-nodes-horizontal">Arrange Horizontal</li>
						<li data-bind="click: app.arrangeY" id="menu-nodes-vertical">Arrange Vertical</li>
						<li data-bind="click: app.arrangeSpiral" id="menu-nodes-spiral">Arrange Spiral</li>
						<li data-bind="click: app.sortAlphabetical" id="menu-nodes-grid">Arrange Alphabetical Grid</li>
					</ul>
				</div>
				<div class="menu">
					<button id="view">View</button>
					<ul class="dropdown" id="menu-view">
						<li id="menu-view-randombackground">
							<span class="check" data-bind="visible: app.config.randomBackground"><i class="ms-Icon ms-Icon--CheckMark"></i></span>
							Random Background Image
						</li>
						<li id="menu-view-blur" data-bind="visible: app.config.randomBackground">
							<span class="check" data-bind="visible: app.config.blurBackground"><i class="ms-Icon ms-Icon--CheckMark"></i></span>
							Blur Background
						</li>
						<li id="menu-view-refresh" data-bind="visible: app.config.randomBackground">
							Refresh Background Image
						</li>
						<hr/>
						<li id="menu-view-snap">
							<span class="check" data-bind="visible: app.config.snap" ><i class="ms-Icon ms-Icon--CheckMark"></i></span>
							Snap To Grid
						</li>
						<hr/>
						<li id="menu-lightmode">Light Mode</li>
						<li id="menu-darkmode">Dark Mode</li>
					</ul>
				</div>
				<div class="menu">
					<button id="help">Help</button>
					<ul class="dropdown" id="menu-help">
						<li id="menu-about" data-bind="click: function() { app.about(true); }">About Yarn</li>
						<li id="menu-github">View Documentation On GitHub</li>
					</ul>
				</div>
				<div id="title" data-bind="text:app.name"></div>
				<div id="frame-controls">
					<button id="minimize">
						<i class="ms-Icon ms-Icon--ChromeMinimize"></i>
					</button>
					<button id="maximize">
						<i class="ms-Icon ms-Icon--ChromeRestore"></i>
					</button>
					<button id="close" data-bind="click:app.close">
						<i class="ms-Icon ms-Icon--ChromeClose"></i>
					</button>
			</header>

			<div id="main">
				<div id="hover-controls">
					<div id="add-node" class="hover-group">
						<label>Add</label>
						<span class="button" data-bind="click:app.newNode" title="Add new node">
							<i class="ms-Icon ms-Icon--Add"></i>
						</span>
					</div>
					<div id="app-sort" class="hover-group hide-when-narrow">
						<label>Arrange</label>
						<span class="button" data-bind="click: app.arrangeX" title="Horizontal">
							<i class="ms-Icon ms-Icon--Sort rotate"></i>
						</span>
						<span class="button" data-bind="click: app.arrangeY" title="Vertical">
							<i class="ms-Icon ms-Icon--Sort"></i>
						</span>
						<span class="button" data-bind="click: app.arrangeSpiral" title="Spiral">
							<i class="ms-Icon ms-Icon--Refresh"></i>
						</span>
						<span class="button" data-bind="click: app.sortAlphabetical" title="Alphabetical grid">
							<i class="ms-Icon ms-Icon--GridViewSmall"></i>
						</span>
					</div>
					<div id="app-undo-redo" class="hover-group -show-when-narrow">
						<label>Undo / redo</label>
						<span class="button" data-bind="click: function() { app.historyDirection('undo'); }" title="Undo">
							<i class="ms-Icon ms-Icon--Undo"></i>
						</span>
						<span class="button" data-bind="click: function() { app.historyDirection('redo'); }" title="Redo">
							<i class="ms-Icon ms-Icon--Redo"></i>
						</span>
					</div>
					<!--
					<div class="app-zoom">
						<span data-bind="click: function() { app.zoom(4); }" title="Zoom 1:1"></span>
						<span data-bind="click: function() { app.zoom(3); }" title="Zoom 2:1"></span>
						<span data-bind="click: function() { app.zoom(2); }" title="Zoom 3:1"></span>
						<span data-bind="click: function() { app.zoom(1); }" title="Zoom 4:1"></span>
					</div>
					-->
				</div>
				<div id="search-controls">
					<input id="nodeSearchInput" type="text" class="search-field" placeholder="Search"/>
					<input type="checkbox" checked="checked" id="search-title" />
					<label for="search-title" title="Search titles"><i class="ms-Icon ms-Icon--FontColorA"></i></label>
					<input type="checkbox" id="search-body" />
					<label for="search-body" title="Search bodies"><i class="ms-Icon ms-Icon--AlignLeft"></i></label>
					<input type="checkbox" id="search-tags" />
					<label for="search-tags" title="search tags"><i class="ms-Icon ms-Icon--Tag"></i></label>
					<span class="button" id="node-list" title="Open node list">
						<i class="ms-Icon ms-Icon--ChevronDownSmall"></i>
					</span>
					<ul id="openHelperMenu" style="display: none;"></ul>
				</div>

				<!--
				<div class="app-menu">
					<div class="menu">
						<span class="title" onmouseover="app.openNodeListMenu('open')">Open</span>
						<div class="dropdown">
							<input id="openHelperMenuFilter" class="search-field" placeholder="search" type="text"  oninput="app.openNodeListMenu('open')"></input>
							<div id="openHelperMenu" ></div>
						</div>
					</div>
				</div>
				-->

				<!-- arrow bg canvas for linked nodes -->
				<canvas class="arrows"></canvas>

				<!-- foreach loop of the nodes -->
				<div class="nodes">
					<div class="nodes-holder" data-bind="foreach: { data: app.nodes, as: 'node' }">
						<div class="node" data-bind="nodeBind: true, css: { inactive: !node.active()}" >
							<div class="title" data-bind="text: node.title"></div>
							<div class="icons">
								<div class="icon colorDown" data-bind="click: node.cycleColorDown">
									<i class="ms-Icon ms-Icon--ChevronLeftSmall"></i>
								</div>
								<div class="icon colorUp" data-bind="click: node.cycleColorUp">
									<i class="ms-Icon ms-Icon--ChevronRightSmall"></i>
								</div>
								<div class="icon delete" data-bind="click: node.tryRemove">
									<i class="ms-Icon ms-Icon--Delete"></i>
								</div>
							</div>
							<div class="body" data-bind="html: node.clippedBody"></div>
							<div class="tags" data-bind="html: node.clippedTags"></div>
						</div>
					</div>
				</div>

				<!-- ko if:app.editing() != null -->
				<div class="node-editor" data-bind="mousedown:app.saveNode">				
				
					<div class="form" data-bind="preventBubble: 'click', preventBubble: 'mousedown'">
						<input type="text" id="editorTitle" class="title" oninput="app.validateTitle()" data-bind="value: app.editing().title;" onfocus="app.togglePreviewMode(true)" placeholder="Title">
						<input type="text" data-bind="value: app.editing().tags;" onfocus="app.togglePreviewMode(true)" placeholder="Tags(use spaces)">


						<div class="bbcode-toolbar">

							<button class="bbcode-button" onclick="app.openLastEditedNode()" title="Go Back to last edited" onfocus="app.togglePreviewMode(false)">
								<i class="ms-Icon ms-Icon--Back"></i>
							</button>

							<hr/>

							<button class="bbcode-button" onclick="app.insertBBcodeTags('b')" title="Bold">
								<i class="ms-Icon ms-Icon--Bold"></i>
							</button>
							<button class="bbcode-button" onclick="app.insertBBcodeTags('u')" title="Underlined">
								<i class="ms-Icon ms-Icon--Underline"></i>
							</button>
							<button class="bbcode-button" onclick="app.insertBBcodeTags('i')" title="Italic">
								<i class="ms-Icon ms-Icon--Italic"></i>
							</button>
							<button class="bbcode-button" onclick="app.insertBBcodeTags('color=#')" title="Color">
								<i class="ms-Icon ms-Icon--Color"></i>
							</button>

							<hr/>

							<button class="bbcode-button" onclick="app.insertBBcodeTags('img')" title="Image">
								<i class="ms-Icon ms-Icon--FileImage"></i>
							</button>
							<button class="bbcode-button" onclick="app.insertBBcodeTags('cmd')" title="Command">
								<i class="ms-Icon ms-Icon--Code"></i>
							</button>
							<button class="bbcode-button" onclick="app.insertBBcodeTags('opt')" title="Choice/Link">
								<i class="ms-Icon ms-Icon--AddLink"></i>
							</button>
							<button class="bbcode-button" onclick="app.insertEmoji()" title="Emoji">
								<i class="ms-Icon ms-Icon--Emoji"></i>
							</button>

							<hr/>

							<button class="bbcode-button" id="button-toggleTagCompletion" onclick="app.toggleTagCompletion()" title="Auto-close tags">
								<span>/&gt;</span>
							</button>

							<button class="bbcode-button" id="button-toggleWordCompletion" onclick="app.toggleWordCompletion()" title="Auto-completion">
								<i class="ms-Icon ms-Icon--AutoEnhanceOn"></i>
							</button>

							<button class="bbcode-button" id="button-toggleSpellCheck" onclick="app.toggleSpellCheck()" title="Spellcheck">
								<i class="ms-Icon ms-Icon--CheckMark"></i>
							</button>

							<hr/>

							<button class="bbcode-button" id="button-toggleTranscribe" onclick="app.toggleTranscribing()" title="Transcribe">
								<i class="ms-Icon ms-Icon--Microphone"></i>
							</button>

							<button class="bbcode-button" onclick="app.speakText()" title="Hear text">
								<i class="ms-Icon ms-Icon--Volume3"></i>
							</button>

							<span class="show-when-narrow">
								<button class="bbcode-button" style="color:#19a4a8" onclick="app.editor.undo()" title="Undo">↶</button>
								<button class="bbcode-button" style="color:#19a4a8" onclick="app.editor.redo()" title="Redo">↷</button>
							</span>

							<button class="bbcode-button" onclick="app.searchTextInEditor()" title="Search (Ctrl+f)">
								<i class="ms-Icon ms-Icon--Search"></i>
							</button>

							<span>
								<select class="styled-dropdown" id="select_language" onchange="app.updateCountry()">
								</select>
							</span>
							<!--
							<div class="app-menu">
								<div class="menu">
									<span class="title" onmouseover="app.openNodeListMenu('link')">Add Link</span>
									<div class="dropdown">
										<input class="search-field" style="text-align:center" placeholder="search" type="text" id="linkHelperMenuFilter" oninput="app.openNodeListMenu('link')"></input>
										<div id="linkHelperMenu"></div>
									</div>
								</div>
							</div>
							-->

						</div>


							<!--
							<span class="styled-checkbox hide-when-narrow">
									<input type="checkbox" id="toglShowCounter" onclick="app.toggleShowCounter()"></input>
									<label for="toglShowCounter" title="Show line counter" style="color:#292929">
										<i class="ms-Icon ms-Icon--NumberedList"></i>
									</label>
							</span>
							-->

						<!-- 
						<div class="bbcode-toolbar">
							<button class="bbcode-button" onclick="app.openLastEditedNode()" title="Go Back to last edited" onfocus="app.togglePreviewMode(false)">&#8617</button>
							&nbsp;
							<button class="bbcode-button" onclick="app.insertBBcodeTags('b')" title="Bold"><b>B</b></button>
							<button class="bbcode-button" onclick="app.insertBBcodeTags('u')" title="Underlined"><u>U</u></button>
							<button class="bbcode-button" onclick="app.insertBBcodeTags('i')" title="Italic"><i>I</i></button>
							<button class="bbcode-button" style="color:green" onclick="app.insertBBcodeTags('color=#')"><text color="pink" title="Color">🌈</text></button>
							<button class="bbcode-button" style="color:#19a4a8" onclick="app.insertBBcodeTags('img')" title="Image">🦄</button>
							<button class="bbcode-button" style="color:purple" onclick="app.insertBBcodeTags('cmd')" title="Command">🎮</button>
							<span class="hide-when-narrow">
								<button class="bbcode-button" style="color:#19a4a8" onclick="app.insertBBcodeTags('opt')" title="Choice/Link">❔</button>
							</span> 
							
							<button class="bbcode-button" style="color:#19a4a8" onclick="app.insertEmoji()" title="Emoji">😉</button>

							<div class="app-menu" style="position: absolute;">
								<div class="menu">
									<span class="title" onmouseover="app.openNodeListMenu('link')">Add Link</span>
									<div class="dropdown">
										<input class="search-field" style="text-align:center" placeholder="search" type="text" id="linkHelperMenuFilter" oninput="app.openNodeListMenu('link')"></input>
										<div  id="linkHelperMenu" ></div>
									</div>
								</div>
							</div>
							&nbsp;
							<span class="styled-checkbox hide-when-narrow">
									<input type="checkbox" id="toglShowCounter" onclick="app.toggleShowCounter()"></input>
									<label for="toglShowCounter" title="Show line counter" style="color:#292929">&#9779</label>
							</span>
							<span class="editor-counter">
								<span class="hide-when-narrow">
										&nbsp;
										Length: <span class="character-count">0</span>
										&nbsp;
										Lines: <span class="line-count">0</span>
										&nbsp;
										<span class="find-text" onclick="app.showRandomQuote()">&#9749</span>
										&nbsp;
										Line: <span class="row-index">0</span>
										&nbsp;
										Col: <span class="column-index">0</span>
								</span>
							</span>

							<span class="styled-checkbox">
								<input type="checkbox" id="toglAutocomplete"></input>
								<label for="toglAutocomplete" title="Auto Close tags" style="color:#292929">🔮</label>
							</span>
							<span class="styled-checkbox hide-when-narrow">
								<input type="checkbox" id="toglAutocompleteWords" onclick="app.toggleWordCompletion()"></input>
								<label for="toglAutocompleteWords" title="auto-completion">💬</label>
							</span>
							<button class="bbcode-button" onclick="app.searchTextInEditor()" title="Search (Ctrl+f)">🔎</button>
							<span class="styled-checkbox">
								<input class="styled-checkbox" type="checkbox" id="toglNightMode" onclick="app.toggleNightMode()"></input>
								<label for="toglNightMode" title="Night Mode"> &#9728 </label>
							</span>
							|
							<span>
								<select class="styled-dropdown" id="select_language" onchange="app.updateCountry()">
									</select>
								</span>
								<span class="styled-checkbox">
									<input class="styled-checkbox" type="checkbox" id="toglSpellCheck" onclick="app.toggleSpellCheck()"></input>
									<label for="toglSpellCheck" title="Spellcheck">&#9745abc</label>
								</span>
							<span class="styled-checkbox hide-when-narrow">
								<input class="styled-checkbox" type="checkbox" id="toglTranscribing" onclick="app.toglTranscribing()"></input>
								<label for="toglTranscribing" title="Transcribe"><span title="Transcribe" class="button-bubble" id="speakTextBtnBubble"></span>🎤</label>
							</span>
							<button  class="bbcode-button" style="color:#19a4a8" onclick="app.speakText()" title="Hear text">🔊</button>

							<span class="show-when-narrow">
								|
								<button class="bbcode-button" style="color:#19a4a8" onclick="app.editor.undo()" title="Undo">↶</button>
								<button class="bbcode-button" style="color:#19a4a8" onclick="app.editor.redo()" title="Redo">↷</button>
							</span>
						
						</div>
						-->

						<div class="editor-container">
							<div class="editor-preview" id="editor-preview" onclick="app.togglePreviewMode(false)"></div>
							<div class="editor" id="editor"
							data-bind="
							ace: app.editing().body, 
							aceOptions: { mode: 'yarn', theme: 'yarn', showPrintMargin: false,
							enableBasicAutocompletion: true,
							enableLiveAutocompletion: true }"
							>
							</div> 
						</div>
						<div class="editor-counter">
							Length: <span class="character-count">0</span>
							&nbsp;
							Lines: <span class="line-count">0</span>
							&nbsp;
							<span class="find-text" onclick="app.showRandomQuote()">&#9749</span>
							&nbsp;
							Line: <span class="row-index">0</span>
							&nbsp;
							Col: <span class="column-index">0</span>
						</div>

						<!--<div class="icon close" data-bind="click:app.saveNode"></div>-->

						<div class="tooltip" id="colorPicker-container" hidden>
							<input type='text' id="colorPicker" data-bind="preventBubble: 'click', preventBubble: 'mousedown'"/>
						</div>

						<div class="tooltip" id="emojiPicker-container">
							<div id="emojiPickerDom"></div>
						</div>

					</div>
				</div>
				<!-- /ko -->

				<!-- ko if:app.deleting() != null -->
				<div class="modal" data-bind="click: function() { app.deleting(null); }">

					<div class="form" data-bind="preventBubble: 'click'">
						<!-- ko if: (app.deleting().selected && (app.getSelectedNodes().length > 1)) -->
						<div>Are you sure you want to remove all the selected nodes?</div>
						<!-- /ko -->
						<!-- ko ifnot: (app.deleting().selected) -->
						<div>Are you sure you want to remove <strong><span data-bind="text: app.deleting().title"></span></strong>?</div>
						<!-- /ko -->
						<!-- ko if: (app.deleting().selected && (app.getSelectedNodes().length == 1)) -->
						<div>Are you sure you want to remove <strong><span data-bind="text: app.deleting().title"></span></strong>?</div>
						<!-- /ko -->
						<div class="buttons">
							<button class="delete" data-bind="click: app.deleting().remove;">Remove the node</button>
							<button class="cancel" data-bind="click: function() { app.deleting(null); }">Cancel</button>
						</div>
					</div>

				</div>
				<!-- /ko -->

				<!-- ko if:app.about() != null -->
				<div class="modal" data-bind="click: function() { app.about(null); }">
					<div class="form" data-bind="preventBubble: 'click'">
						<div>
							<h1>Yarn</h1>
							<p>Dialogue editor created for "Night in the Woods" (and other projects) by @NoelFB, @blurymind and @infinite_ammo with contributions from @seiyria, @beeglebug, and @ashildebrandt.</p>
							<p>It is heavily inspired by and based on the amazing Twine software: http://twinery.org/</p>
							<p>Background images supplied by Unsplash.</p>
							<p>Version <span data-bind="text:app.version"></span></p>
						</div>
						<div class="buttons">
							<button class="cancel" data-bind="click: function() { app.about(null); }">Cool</button>
						</div>
					</div>
				</div>
				<!-- /ko -->
				
				<!-- marquee -->
				<div id="marquee"></div>
			</div>
		</div>

		<!-- Hidden fields, file dialogs, and elements -->
		<div class="hidden">
			<input type="file" id="open-image" accept=".jpg,.jpeg,.png,.gif,.bmp"/>
			<input type="file" id="open-file" accept=".yarn,.txt,.xml,.json,.twee,.tw2"/>
			<input type="file" id="open-folder" webkitdirectory directory/>
			<input type="file" id="save-file" nwsaveas="filename.txt" />
		</div>
		<!-- templates container (they get loaded into this) -->
		<div class="templates">
		</div>
	</body>
</html>
